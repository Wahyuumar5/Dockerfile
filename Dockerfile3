FROM ubuntu:22.04

# Install dependencies
RUN apt-get update && apt-get install -y \
    xfce4 xfce4-goodies xorg dbus-x11 x11-xserver-utils \
    novnc websockify python3-pip supervisor wget curl net-tools \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Buat folder kerja
WORKDIR /root

# Download dan setup noVNC
RUN mkdir -p /opt/novnc/utils/websockify && \
    ln -s /opt/novnc/vnc.html /opt/novnc/index.html

# Expose port (gunakan port Clever Cloud)
ENV PORT=8080
EXPOSE 8080

# File supervisor config
RUN echo '[program:x11]' > /etc/supervisor/conf.d/supervisord.conf && \
    echo 'command=/usr/bin/startxfce4' >> /etc/supervisor/conf.d/supervisord.conf && \
    echo '[program:novnc]' >> /etc/supervisor/conf.d/supervisord.conf && \
    echo 'command=/usr/bin/websockify --web=/usr/share/novnc/ ${PORT} localhost:5901' >> /etc/supervisor/conf.d/supervisord.conf

# Start X server, noVNC, dan XFCE via supervisord
CMD ["/usr/bin/supervisord", "-n"]
