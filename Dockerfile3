# ===============================
# BASE IMAGE
# ===============================
FROM ubuntu:22.04

# ===============================
# ENVIRONMENT SETUP
# ===============================
ENV DEBIAN_FRONTEND=noninteractive
ENV USER=root
WORKDIR /root

# ===============================
# INSTALL DESKTOP, VNC & TOOLS
# ===============================
RUN apt update && apt install -y \
    xfce4 xfce4-goodies \
    x11vnc xvfb \
    novnc websockify \
    python3 python3-pip \
    wget curl nano git \
    && apt clean && rm -rf /var/lib/apt/lists/*

# ===============================
# SETUP PASSWORD UNTUK VNC
# ===============================
RUN mkdir ~/.vnc && \
    x11vnc -storepasswd 123456 ~/.vnc/passwd

# ===============================
# STARTUP SCRIPT
# ===============================
RUN echo '#!/bin/bash\n\
Xvfb :0 -screen 0 1024x768x16 &\n\
export DISPLAY=:0\n\
startxfce4 &\n\
websockify --web=/usr/share/novnc/ --cert=/etc/ssl/certs/ssl-cert-snakeoil.pem --key=/etc/ssl/private/ssl-cert-snakeoil.key 6080 localhost:5900 &' > /root/startup.sh && \
chmod +x /root/startup.sh

# ===============================
# EXPOSE PORT
# ===============================
EXPOSE 6080

# ===============================
# RUN COMMAND
# ===============================
CMD ["/bin/bash", "/root/startup.sh"]
